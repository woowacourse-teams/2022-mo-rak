node {
    stage('check-out') {
        // Get some code from a GitHub repository
        git url: 'https://github.com/woowacourse-teams/2022-mo-rak.git',
            branch: 'dev'
    }

    stage('build') {
        dir ('./backend') {
            sh './gradlew clean build'
        }
    }

    stage('deploy') {
        dir ('./backend/build/libs') {
            sh 'scp -i /var/lib/jenkins/key-morak.pem ./*.jar ubuntu@192.168.1.123:/home/ubuntu'
            sh 'ssh -i /var/lib/jenkins/key-morak.pem ubuntu@192.168.1.123 "sh /home/ubuntu/start_service.sh 2>/dev/null"'
        }
    }
}

